package com.greglturnquist.hackingspringboot.reactive;

import org.springframework.data.domain.Example;
import org.springframework.data.domain.ExampleMatcher;
import org.springframework.data.domain.ExampleMatcher.StringMatcher;

import reactor.core.publisher.Flux;

public class InventoryService {

	private final ItemRepository itemRepository;
	private final CartRepository cartRepository;

	//private String description;

	InventoryService(ItemRepository itemRepository, CartRepository cartRepository){
		this.itemRepository = itemRepository;
		this.cartRepository = cartRepository;
	}

	Flux<Item> searchByExample(String name, String description,  boolean useAnd){
		Item item = new Item(name, description, 0.0);
		
		ExampleMatcher matcher = (useAnd 
				? ExampleMatcher.matchingAll() //
				: ExampleMatcher.matchingAny()) //
					.withStringMatcher(StringMatcher.CONTAINING)
					.withIgnoreCase()
					.withIgnorePaths("price");
		Example<Item> probe = Example.of(item, matcher);
		return itemRepository.findAll(probe);
	}
	
}
